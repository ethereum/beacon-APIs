get:
  operationId: getExecutionPayloadEnvelope
  summary: Get execution payload envelope
  description: |
    Retrieves the cached execution payload envelope for the current proposer's slot, which can
    then be signed and published by the validator. The envelope contains the full execution payload
    along with associated metadata.

    The beacon node only caches the envelope for the current slot's self-built payload. Requests for
    older slots or slots where no envelope has been cached will return a 404 error. This endpoint does
    not fetch payloads from the execution layer.

    Depending on `Accept` header, the response can be returned either as JSON or as bytes serialized by SSZ.
  tags:
    - Validator
    - ValidatorRequiredApi
  parameters:
    - name: slot
      in: path
      required: true
      description: "Slot for which the execution payload envelope is requested."
      schema:
        $ref: "../../beacon-node-oapi.yaml#/components/schemas/Uint64"
    - name: beacon_block_root
      in: query
      required: false
      description: |
        Optional root of the beacon block associated with this execution payload envelope.
        When provided, the beacon node will verify that the cached envelope matches the
        given block root, returning a 404 if there is no match. This is useful for
        disambiguation in fork scenarios where the same slot may have multiple competing blocks.
      schema:
        $ref: "../../beacon-node-oapi.yaml#/components/schemas/Root"
  responses:
    "200":
      description: "Successful response"
      headers:
        Eth-Consensus-Version:
          $ref: "../../beacon-node-oapi.yaml#/components/headers/Eth-Consensus-Version"
      content:
        application/json:
          schema:
            title: GetExecutionPayloadEnvelopeResponse
            type: object
            required: [version, data]
            properties:
              version:
                type: string
                enum: [gloas]
                example: "gloas"
              data:
                $ref: "../../beacon-node-oapi.yaml#/components/schemas/Gloas.ExecutionPayloadEnvelope"
        application/octet-stream:
          schema:
            description: "SSZ serialized `ExecutionPayloadEnvelope` bytes. Use Accept header to choose this response type"
    "400":
      description: "Invalid execution payload envelope request"
      content:
        application/json:
          schema:
            $ref: "../../beacon-node-oapi.yaml#/components/schemas/ErrorMessage"
          example:
            code: 400
            message: "Invalid slot parameter"
    "404":
      description: "No cached execution payload envelope available for the requested slot. The beacon node only caches the envelope for the current proposer's self-built payload."
      content:
        application/json:
          schema:
            $ref: "../../beacon-node-oapi.yaml#/components/schemas/ErrorMessage"
          example:
            code: 404
            message: "Execution payload envelope not available for slot"
    "406":
      $ref: "../../beacon-node-oapi.yaml#/components/responses/NotAcceptable"
    "500":
      $ref: "../../beacon-node-oapi.yaml#/components/responses/InternalError"
